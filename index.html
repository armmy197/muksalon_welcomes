<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ร้านเสริมสวยมุกซาลอน</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- เพิ่ม Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Kanit', 'Sukhumvit Set', 'Sarabun', sans-serif;
        }
        
        body {
            background-color: #f9f0ff;
            color: #4a154b;
            line-height: 1.6;
            padding: 0;
            margin: 0;
            position: relative;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        /* ปุ่มล็อกอินด่วน */
        .quick-login {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .quick-login-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #4a154b;
            color: white;
            border: none;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.3s;
            z-index: 1001;
        }
        
        .quick-login-btn:hover {
            transform: scale(1.1);
            background: #6a1b6d;
        }
        
        /* Header */
        header {
            background: linear-gradient(135deg, #d291bc 0%, #ffdfd3 100%);
            padding: 15px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
            z-index: 10;
        }
        
        .header-content {
            text-align: center;
            margin-bottom: 10px;
        }
        
        .cute-float {
            animation: float 3s ease-in-out infinite;
            color: #4a154b;
            font-size: 1.8rem;
            text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.7);
            margin-bottom: 10px;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .admin-panel {
            text-align: center;
        }
        
        .login-btn {
            background: #06C755;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .login-btn:hover {
            background: #05a848;
            transform: translateY(-2px);
        }
        
        .line-icon {
            background: white;
            color: #06C755;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
        }
        
        .admin-only {
            display: none;
            margin-top: 10px;
        }
        
        .logged-in .admin-only {
            display: block;
        }
        
        .logout-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            margin-left: 8px;
            font-size: 0.8rem;
        }
        
        /* Navigation */
        nav {
            display: flex;
            justify-content: center;
            background: white;
            padding: 10px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        nav button {
            background: none;
            border: none;
            padding: 8px 15px;
            margin: 0 5px;
            cursor: pointer;
            font-size: 0.9rem;
            color: #4a154b;
            border-radius: 20px;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        nav button:hover, nav button.active {
            background: #4a154b;
            color: white;
        }
        
        /* Mobile Menu Button - แก้ไขตำแหน่งให้อยู่ขวาสุด */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #4a154b;
            cursor: pointer;
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 100;
        }
        
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 99;
        }
        
        .overlay.active {
            display: block;
        }
        
        /* Pages */
        .page {
            display: none;
            padding: 20px 0;
            animation: fadeIn 0.5s;
        }
        
        .activePage {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .box {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 15px auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            max-width: 800px;
            position: relative;
            z-index: 5;
        }
        
        .box h2 {
            color: #4a154b;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid #ffdfd3;
            padding-bottom: 10px;
            font-size: 1.5rem;
        }
        
        .box h3 {
            color: #6a1b6d;
            margin: 10px 0;
            font-size: 1.2rem;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        button {
            background: #d291bc;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            margin: 5px;
            transition: all 0.3s;
            width: 100%;
        }
        
        button:hover {
            background: #b76e94;
            transform: translateY(-2px);
        }
        
        .delete-btn {
            background: #ff4757;
        }
        
        .delete-btn:hover {
            background: #ff2e43;
        }
        
        .service-item, .holiday-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .message {
            text-align: center;
            font-size: 1.1rem;
            color: #4a154b;
            padding: 15px;
        }
        
        /* Review Stars */
        .stars {
            color: #ffc107;
            font-size: 1.5rem;
            margin: 10px 0;
            text-align: center;
        }
        
        .stars span {
            cursor: pointer;
            transition: all 0.2s;
            margin: 0 2px;
        }
        
        .stars span:hover, .stars span.active {
            transform: scale(1.2);
            text-shadow: 0 0 5px rgba(255, 193, 7, 0.8);
        }
        
        /* Review Modal */
        .review-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 15px;
        }
        
        .review-modal-content {
            background: white;
            padding: 20px;
            border-radius: 15px;
            width: 100%;
            max-width: 500px;
            text-align: center;
            position: relative;
            z-index: 1001;
        }
        
        /* Gmail Configuration */
        .gmail-config {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .instructions {
            background: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
        }
        
        .instructions ol {
            text-align: left;
            padding-left: 20px;
            margin: 8px 0;
        }
        
        .instructions li {
            margin-bottom: 6px;
            font-size: 0.9rem;
        }
        
        .config-section {
            margin: 12px 0;
            text-align: left;
        }
        
        .config-section label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .test-result {
            margin-top: 12px;
            padding: 8px;
            border-radius: 5px;
            display: none;
            font-size: 0.9rem;
        }
        
        .test-result.success {
            background: #d4edda;
            color: #155724;
            display: block;
        }
        
        .test-result.error {
            background: #f8d7da;
            color: #721c24;
            display: block;
        }
        
        /* Booking Items */
        .booking-item {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            padding: 15px;
            border-radius: 12px;
            margin: 12px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-left: 4px solid #d291bc;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .booking-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }

        .booking-content {
            margin-bottom: 12px;
        }

        .booking-content p {
            margin: 6px 0;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .booking-content strong {
            color: #4a154b;
            display: inline-block;
            min-width: 70px;
        }

        .services-section {
            margin: 8px 0;
        }

        .services-list {
            background: #f9f0ff;
            padding: 8px 12px;
            border-radius: 6px;
            margin: 4px 0;
            list-style-type: none;
        }

        .services-list li {
            padding: 4px 0;
            border-bottom: 1px dashed #e0e0e0;
            position: relative;
            padding-left: 18px;
            font-size: 0.85rem;
        }

        .services-list li:before {
            content: "•";
            color: #d291bc;
            position: absolute;
            left: 0;
            font-size: 16px;
        }

        .services-list li:last-child {
            border-bottom: none;
        }

        .booking-actions {
            text-align: center;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #f0f0f0;
        }

        .delete-btn {
            background: linear-gradient(135deg, #ff4757, #ff2e43);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            width: auto;
        }

        .delete-btn:hover {
            background: linear-gradient(135deg, #ff2e43, #ff1e36);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(255, 71, 87, 0.3);
        }

        /* การแจ้งเตือน */
        .notification {
            position: fixed;
            top: 15px;
            right: 15px;
            padding: 12px 16px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-width: 250px;
            max-width: 90%;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            animation: slideInRight 0.3s ease;
        }

        .notification.success {
            background: linear-gradient(135deg, #06C755, #05a848);
        }

        .notification.error {
            background: linear-gradient(135deg, #ff4757, #ff2e43);
        }

        .notification.warning {
            background: linear-gradient(135deg, #ffa502, #ff7e00);
        }

        .notification button {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
            padding: 0;
            margin: 0;
            width: 18px;
            height: 18px;
            width: auto;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Confetti */
        .confetti {
            position: fixed;
            width: 8px;
            height: 8px;
            background: #f00;
            top: -10px;
            z-index: 9999;
            pointer-events: none;
        }

        /* Floating Icons */
        .floating-icon {
            position: fixed;
            font-size: 20px;
            z-index: -1;
            opacity: 0.7;
            animation: floatAround 20s infinite linear;
        }

        @keyframes floatAround {
            0% {
                transform: translate(0, 0) rotate(0deg);
            }
            25% {
                transform: translate(100px, 100px) rotate(90deg);
            }
            50% {
                transform: translate(200px, 50px) rotate(180deg);
            }
            75% {
                transform: translate(100px, 150px) rotate(270deg);
            }
            100% {
                transform: translate(0, 0) rotate(360deg);
            }
        }

        /* Background Effects */
        .bg-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            pointer-events: none;
        }

        .rotating-bg {
            background: linear-gradient(45deg, #ffdfd3, #d291bc, #f9f0ff, #ffdfd3);
            background-size: 400% 400%;
            animation: gradientRotate 15s ease infinite;
        }

        @keyframes gradientRotate {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        /* Progress Bar */
        .progress-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            position: relative;
        }
        
        .progress-step {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            z-index: 2;
            font-size: 0.8rem;
        }
        
        .progress-step.active {
            background: #d291bc;
        }
        
        .progress-step.completed {
            background: #4a154b;
        }
        
        .progress-bar::before {
            content: "";
            position: absolute;
            top: 12px;
            left: 0;
            right: 0;
            height: 2px;
            background: #ddd;
            z-index: 1;
        }
        
        .step-label {
            position: absolute;
            top: 30px;
            font-size: 0.7rem;
            text-align: center;
            width: 80px;
            left: -30px;
            display: none;
        }

        /* Security Badge */
        .security-badge {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 12px;
            border-radius: 16px;
            font-size: 0.7rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Service Selection */
        .service-selection {
            margin: 12px 0;
        }
        
        .service-option {
            display: flex;
            align-items: center;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin: 6px 0;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .service-option:hover {
            background: #f9f0ff;
            border-color: #d291bc;
        }
        
        .service-option input {
            margin-right: 8px;
            width: auto;
        }
        
        .service-option label {
            flex: 1;
            cursor: pointer;
            font-size: 0.9rem;
        }

        /* Button Groups */
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }
        
        .button-group button {
            flex: 1;
            min-width: 120px;
        }

        /* เมนูมือถือแบบใหม่ - แก้ไขให้อยู่ขวาและไม่บังข้อมูล */
        .mobile-nav {
            display: none;
            position: fixed;
            top: 0;
            right: -300px; /* เริ่มต้นนอกหน้าจอด้านขวา */
            width: 280px;
            height: 100vh;
            background: white;
            box-shadow: -5px 0 15px rgba(0,0,0,0.1);
            z-index: 100;
            transition: right 0.3s ease;
            padding-top: 70px;
        }
        
        .mobile-nav.active {
            right: 0; /* เลื่อนเข้ามาในหน้าจอ */
        }
        
        .mobile-nav button {
            display: block;
            width: 100%;
            padding: 15px 20px;
            text-align: left;
            border: none;
            background: none;
            border-bottom: 1px solid #f0f0f0;
            font-size: 1rem;
            color: #4a154b;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .mobile-nav button:hover, .mobile-nav button.active {
            background: #4a154b;
            color: white;
        }
        
        .mobile-nav-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #4a154b;
            cursor: pointer;
        }

       /* Review Items Styling */
.review-item {
    background: linear-gradient(135deg, #ffffff, #f8f9fa);
    padding: 15px;
    border-radius: 12px;
    margin: 12px 0;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    border-left: 4px solid #ffc107;
    position: relative;
}

.review-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.reviewer-name {
    font-weight: bold;
    color: #4a154b;
    font-size: 1.1rem;
}

.review-date {
    font-size: 0.8rem;
    color: #888;
}

.review-actions {
    text-align: right;
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid #f0f0f0;
}

.review-actions .delete-btn {
    width: auto;
    padding: 6px 12px;
    font-size: 0.8rem;
}

.review-actions .delete-btn i {
    margin-right: 5px;
}

        /* Firebase Config Section */
        .firebase-config {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }

        /* Time Slots Styling */
        .time-slots {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .time-slot {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .time-slot:hover {
            background: #f9f0ff;
            border-color: #d291bc;
        }

        .time-slot.selected {
            background: #d291bc;
            color: white;
            border-color: #d291bc;
        }

        .time-slot.booked {
            background: #ff6b6b;
            color: white;
            border-color: #ff6b6b;
            cursor: not-allowed;
        }

        .time-slot.booked:hover {
            background: #ff6b6b;
        }

        /* Promo Items Styling */
        .promo-item {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            padding: 15px;
            border-radius: 12px;
            margin: 12px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-left: 4px solid #d291bc;
            position: relative;
        }

        .promo-image {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .promo-title {
            font-weight: bold;
            color: #4a154b;
            font-size: 1.2rem;
            margin-bottom: 8px;
        }

        .promo-description {
            color: #6a1b6d;
            line-height: 1.5;
        }

        /* Responsive Design */
        @media (min-width: 768px) {
            .container {
                padding: 0 20px;
            }
            
            header {
                padding: 20px 0;
            }
            
            .cute-float {
                font-size: 2.2rem;
            }
            
            nav button {
                padding: 10px 20px;
                margin: 0 10px;
                font-size: 1rem;
            }
            
            .page {
                padding: 30px 0;
            }
            
            .box {
                padding: 25px;
                margin: 20px auto;
            }
            
            .box h2 {
                font-size: 1.8rem;
                margin-bottom: 20px;
            }
            
            button {
                width: auto;
            }
            
            .button-group {
                flex-wrap: nowrap;
            }
            
            .step-label {
                display: block;
            }
            
            .progress-step {
                width: 30px;
                height: 30px;
                font-size: 1rem;
            }
            
            .progress-bar::before {
                top: 15px;
            }
            
            /* ซ่อนเมนูมือถือบนเดสก์ท็อป */
            .mobile-menu-btn, .mobile-nav {
                display: none;
            }
        }

        @media (max-width: 767px) {
            /* ซ่อนเมนูปกติบนมือถือ */
            nav {
                display: none;
            }
            
            /* แสดงปุ่มเมนูมือถือ */
            .mobile-menu-btn {
                display: block;
            }
            
            /* แสดงเมนูมือถือ */
            .mobile-nav {
                display: block;
            }
            
            .container {
                padding: 0 10px;
            }
            
            .cute-float {
                font-size: 1.5rem;
            }
            
            .login-btn {
                padding: 8px 15px;
                font-size: 0.8rem;
            }
            
            .box {
                padding: 15px;
                margin: 10px auto;
            }
            
            .booking-item {
                padding: 12px;
            }
            
            .notification {
                min-width: calc(100% - 30px);
                right: 15px;
                left: 15px;
            }
            
            .security-badge {
                bottom: 70px;
                left: 10px;
                right: 10px;
                text-align: center;
            }
            
            .time-slots {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 480px) {
            .cute-float {
                font-size: 1.3rem;
            }
            
            .box {
                padding: 12px;
                margin: 8px auto;
            }
            
            .mobile-nav {
                width: 250px;
            }
            
            .time-slots {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Background Effects -->
    <div class="bg-effect rotating-bg"></div>
    
    <!-- Floating Icons -->
    <div id="floatingIcons"></div>
    
    <!-- Confetti Container -->
    <div id="confettiContainer"></div>
    
    <!-- Security Badge -->
    <div class="security-badge">
        <i class="fas fa-shield-alt" style="color: #4a154b;"></i>
        <span>ระบบปลอดภัย | ข้อมูลถูกเก็บเป็นความลับ</span>
    </div>
    
    <!-- ปุ่มล็อกอินด่วน -->
    <div class="quick-login">
        <button class="quick-login-btn" onclick="quickLogin()">🔑</button>
    </div>

    <header>
        <div class="container">
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()">☰</button>
            <div class="header-content">
                <h1 class="cute-float">ร้านเสริมสวยมุกซาลอน 💖</h1>
            <div class="admin-panel">
                <button id="loginBtn" class="login-btn" onclick="loginWithLine()">
                    <span class="line-icon">L</span> ล็อคอินสำหรับเจ้าของร้าน
                </button>
                <div id="adminMenu" class="admin-only">
                    <button onclick="showPage('manage')">จัดการร้าน</button>
                    <button class="logout-btn" onclick="logout()">ล็อกเอาท์</button>
                </div>
            </div>
        </div>
    </header>

    <!-- เมนูปกติสำหรับเดสก์ท็อป -->
    <nav id="mainNav">
        <button class="active" onclick="showPage('home')">หน้าหลัก</button>
        <button onclick="showPage('booking')">จองคิว</button>
        <button onclick="showPage('promo')">โปรโมชัน</button>
        <button onclick="showPage('reviews')">รีวิว</button>
    </nav>

    <!-- เมนูมือถือแบบใหม่ -->
    <div class="mobile-nav" id="mobileNav">
        <button class="mobile-nav-close" onclick="toggleMobileMenu()">×</button>
        <button class="active" onclick="showPage('home')">หน้าหลัก</button>
        <button onclick="showPage('booking')">จองคิว</button>
        <button onclick="showPage('promo')">โปรโมชัน</button>
        <button onclick="showPage('reviews')">รีวิว</button>
    </div>

    <div class="overlay" id="overlay" onclick="toggleMobileMenu()"></div>

    <div class="container">
        <!-- หน้า Home -->
        <div id="home" class="page activePage">
            <div class="box">
                <h2>บริการของทางร้าน</h2>
                <ul id="servicesList" style="text-align:left; list-style-type: none; padding: 0;"></ul>
                <div class="admin-only">
                    <h3>จัดการบริการ</h3>
                    <input type="text" id="newServiceName" placeholder="ชื่อบริการ">
                    <input type="text" id="newServicePrice" placeholder="ราคา">
                    <button onclick="addService()">เพิ่มบริการ</button>
                </div>

                <h3>วันหยุดของร้าน</h3>
                <ul id="holidayList" style="color:red; text-align:left; list-style-type: none; padding: 0;"></ul>
                <div class="admin-only">
                    <input type="date" id="newHoliday">
                    <button onclick="addHoliday()">เพิ่มวันหยุด</button>
                </div>
            </div>
        </div>

        <!-- หน้า Booking - ปรับเป็นหน้าเดียว -->
        <div id="booking" class="page">
            <div class="box">
                <h2>จองคิว 💇‍♀️</h2>
                
                <div class="booking-form">
                    <div class="form-section">
                        <h3>ข้อมูลลูกค้า 👤</h3>
                        <input type="text" id="name" placeholder="ชื่อของคุณ">
                        <input type="tel" id="phone" placeholder="เบอร์โทรศัพท์">
                    </div>
                    
                    <div class="form-section">
                        <h3>เลือกบริการ 💇‍♀️</h3>
                        <div id="serviceSelection" class="service-selection"></div>
                    </div>
                    
                    <div class="form-section">
                        <h3>เลือกวันและเวลา 📅</h3>
                        <input type="date" id="date">
                        <div class="time-slots" id="timeSlots"></div>
                    </div>
                    
                    <div class="button-group">
                        <button onclick="submitBooking()">ยืนยันการจอง</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- หน้าโปรโมชัน -->
        <div id="promo" class="page">
            <div class="box">
                <h2>โปรโมชั่น</h2>
                <div id="promoContent"></div>

                <div class="admin-only">
                    <h3>จัดการโปรโมชัน</h3>
                    <input type="text" id="promoTitle" placeholder="หัวข้อโปรโมชัน">
                    <textarea id="promoDescription" placeholder="รายละเอียดโปรโมชัน" rows="3"></textarea>
                    <input type="file" id="promoImageFile" accept="image/*">
                    <button onclick="addPromo()">เพิ่มโปรโมชัน</button>
                </div>
            </div>
        </div>

        <!-- หน้ารีวิว -->
        <div id="reviews" class="page">
            <div class="box">
                <h2>รีวิวจากลูกค้า</h2>
                <div id="reviewsList"></div>
            </div>
        </div>

        <!-- หน้าจัดการร้าน -->
        <div id="manage" class="page">
            <div class="box">
                <h2>จัดการร้าน</h2>
                <div class="button-group">
                    <button onclick="showPage('home')">จัดการบริการและวันหยุด</button>
                    <button onclick="showPage('promo')">จัดการโปรโมชัน</button>
                </div>

                <div class="box">
                    <h2>ตั้งค่าแจ้งเตือนอีเมล</h2>
                    <div class="gmail-config">
                        <div class="config-section">
                            <label for="emailJSPublicKey">EmailJS Public Key:</label>
                            <input type="text" id="emailJSPublicKey" placeholder="ใส่ Public Key">
                        </div>

                        <div class="config-section">
                            <label for="emailJSServiceID">EmailJS Service ID:</label>
                            <input type="text" id="emailJSServiceID" placeholder="ใส่ Service ID">
                        </div>

                        <div class="config-section">
                            <label for="emailJSTemplateID">EmailJS Template ID:</label>
                            <input type="text" id="emailJSTemplateID" placeholder="ใส่ Template ID">
                        </div>

                        <div class="config-section">
                            <label for="adminEmail">อีเมลผู้รับการแจ้งเตือน:</label>
                            <input type="email" id="adminEmail" placeholder="ใส่อีเมลสำหรับรับการแจ้งเตือน">
                        </div>

                        <div class="button-group">
                            <button onclick="saveEmailConfig()">บันทึกการตั้งค่า</button>
                            <button onclick="testEmailConnection()">ทดสอบการเชื่อมต่อ</button>
                        </div>

                        <div id="testResult" class="test-result"></div>
                    </div>
                </div>

                <div class="box">
                    <h2>ตั้งค่า Firebase</h2>
                    <div class="firebase-config">
                        <div class="config-section">
                            <label for="firebaseConfig">Firebase Configuration:</label>
                            <textarea id="firebaseConfig" placeholder='{"apiKey": "...", "authDomain": "...", "projectId": "...", "storageBucket": "...", "messagingSenderId": "...", "appId": "..."}' rows="6"></textarea>
                        </div>
                        <div class="button-group">
                            <button onclick="saveFirebaseConfig()">บันทึกการตั้งค่า Firebase</button>
                            <button onclick="testFirebaseConnection()">ทดสอบการเชื่อมต่อ Firebase</button>
                        </div>
                        <div id="firebaseTestResult" class="test-result"></div>
                    </div>
                </div>

                <h3>การจองล่าสุด</h3>
                <div id="bookingList"></div>

                <h3>จัดการรีวิว</h3>
                <div id="reviewsManagementList"></div>
            </div>
        </div>
    </div>

    <!-- Modal สำหรับรีวิว -->
    <div class="review-modal" id="reviewModal">
        <div class="review-modal-content">
            <h2>รีวิวการใช้บริการ</h2>
            <input type="text" id="reviewerName" placeholder="ชื่อของคุณ (ไม่จำเป็น)">
            <div class="stars" id="modalStars">
                <span onclick="setModalRating(1)">★</span>
                <span onclick="setModalRating(2)">★</span>
                <span onclick="setModalRating(3)">★</span>
                <span onclick="setModalRating(4)">★</span>
                <span onclick="setModalRating(5)">★</span>
            </div>
            <textarea id="reviewComment" placeholder="ความคิดเห็น (ไม่จำเป็น)" rows="3"></textarea>
            <div class="button-group">
                <button onclick="submitReview()">ส่งรีวิว</button>
            </div>
            <p id="thanksMsg"></p>
        </div>
    </div>

    <!-- Load EmailJS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3.2.0/dist/email.min.js"></script>

    <script>
        // ฟังก์ชันสำหรับเมนูมือถือแบบใหม่
        function toggleMobileMenu() {
            const mobileNav = document.getElementById("mobileNav");
            const overlay = document.getElementById("overlay");
            
            mobileNav.classList.toggle("active");
            overlay.classList.toggle("active");
            
            // ป้องกันการสกรอลพื้นหลังเมื่อเมนูเปิด
            document.body.style.overflow = mobileNav.classList.contains("active") ? "hidden" : "";
        }
        
        // ตั้งค่า Firebase Configuration โดยตรง - ย้ายมาอยู่ด้านบนสุด
        const firebaseConfig = { 
            apiKey: "AIzaSyCHDTfUAYl_3QNltoDomAZip369XRePm08",
            authDomain: "muksalon-welcome529.firebaseapp.com",
            projectId: "muksalon-welcome529",
            storageBucket: "muksalon-welcome529.firebasestorage.app",
            messagingSenderId: "763113739059",
            appId: "1:763113739059:web:b3632852dab45f66522446"
        };

        // ตัวแปร global
        let booking = {};
        let bookingLocked = false;
        let currentRating = 0;
        let isLoggedIn = localStorage.getItem('isLoggedIn') === 'true' || false;

        // ข้อมูลเริ่มต้น - จะถูกโหลดจาก Firebase แทน localStorage
        let holidays = [];
        let services = [];
        let promotions = [];
        let reviews = [];
        let bookings = [];

        // ตัวแปรสำหรับ Firebase
        let db = null;
        let firebaseInitialized = false;

        // ข้อมูลการตั้งค่า Email
        let emailConfig = {
            publicKey: 'gxAXWtkmg5TT3Rm-E',
            serviceID: 'service_muk157',
            templateID: 'template_muk157',
            adminEmail: 'muksalonwelcomes@gmail.com'
        };

        // ฟังก์ชันเริ่มต้น Firebase - ย้ายมาอยู่ก่อน DOMContentLoaded
        function initializeFirebase(config) {
            try {
                // ตรวจสอบว่า Firebase ถูกโหลดมาหรือยัง
                if (typeof firebase === 'undefined') {
                    console.error("❌ Firebase SDK ยังไม่โหลด");
                    return false;
                }
                
                // ถ้าเคยเริ่มต้นแล้ว ให้ลบแอปเก่าก่อน
                if (firebase.apps.length > 0) {
                    firebase.app().delete();
                }
                
                firebase.initializeApp(config);
                db = firebase.firestore();
                firebaseInitialized = true;
                console.log("✅ Firebase เริ่มต้นสำเร็จ");
                return true;
            } catch (error) {
                console.error("❌ เกิดข้อผิดพลาดในการเริ่มต้น Firebase:", error);
                firebaseInitialized = false;
                return false;
            }
        }

        // โหลดการตั้งค่าจาก localStorage ถ้ามี
        try {
            const savedConfig = localStorage.getItem('emailConfig');
            if (savedConfig) {
                const parsedConfig = JSON.parse(savedConfig);
                Object.keys(parsedConfig).forEach(key => {
                    if (parsedConfig[key]) {
                        emailConfig[key] = parsedConfig[key];
                    }
                });
            }
        } catch (e) {
            console.log('ใช้การตั้งค่าเริ่มต้น');
        }

        // เริ่มต้นแสดงหน้าจองคิวเมื่อโหลดหน้า
        window.addEventListener('DOMContentLoaded', (event) => {
            // เริ่มต้น Firebase ด้วย config ที่ประกาศไว้
            initializeFirebase(firebaseConfig);
            
            // แสดง Firebase Config ในฟอร์มจัดการร้าน
            document.getElementById('firebaseConfig').value = JSON.stringify(firebaseConfig, null, 2);
            
            // เริ่มต้น EmailJS ด้วยค่าที่ตั้งไว้
            if (emailConfig.publicKey && emailConfig.publicKey !== 'your_public_key_here') {
                emailjs.init(emailConfig.publicKey);
            }
            
            // แสดงค่าปัจจุบันในฟอร์ม
            document.getElementById('emailJSPublicKey').value = emailConfig.publicKey;
            document.getElementById('emailJSServiceID').value = emailConfig.serviceID;
            document.getElementById('emailJSTemplateID').value = emailConfig.templateID;
            document.getElementById('adminEmail').value = emailConfig.adminEmail;
            
            // ล็อกอินอัตโนมัติหากเคยล็อกอินไว้
            if (isLoggedIn) {
                document.body.classList.add('logged-in');
            }
            
            // โหลดข้อมูลจาก Firebase ถ้าเชื่อมต่อแล้ว
            if (firebaseInitialized) {
                loadDataFromFirebase();
            } else {
                // โหลดข้อมูลจาก localStorage เป็น fallback
                loadDataFromLocalStorage();
            }
            
            renderHolidays();
            renderServices();
            renderPromotions();
            renderReviews();
            
            // สร้างลูกเล่นพิเศษ
            createFloatingIcons();
            createParticles();
            
            // แสดงหน้าจองคิวเป็นหน้าแรก
            showPage('booking');
            
            // ตั้งค่า min date สำหรับ input date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').min = today;
            
            // เพิ่ม event listener สำหรับการเลือกวันที่
            document.getElementById('date').addEventListener('change', function() {
                renderTimeSlots(this.value);
            });
            
            // แสดงบริการสำหรับการจองทันที
            renderServicesForBooking();
        });

        // ฟังก์ชันสร้าง time slots
        function renderTimeSlots(date) {
            const timeSlotsContainer = document.getElementById('timeSlots');
            timeSlotsContainer.innerHTML = '';
            
            if (!date) return;
            
            // ตรวจสอบว่าวันที่เลือกเป็นวันหยุดหรือไม่
            if (holidays.includes(date)) {
                timeSlotsContainer.innerHTML = '<p style="color: red; text-align: center;">วันนี้ร้านปิด กรุณาเลือกวันอื่น</p>';
                return;
            }
            
            // สร้าง time slots จาก 8:00 ถึง 20:00
            for (let h = 8; h <= 20; h++) {
                const timeSlot = document.createElement('div');
                timeSlot.className = 'time-slot';
                timeSlot.textContent = `${h}:00`;
                timeSlot.dataset.time = `${h}:00`;
                
                // ตรวจสอบว่าช่วงเวลานี้ถูกจองแล้วหรือไม่
                const isBooked = bookings.some(booking => 
                    booking.date === date && booking.time === `${h}:00`
                );
                
                if (isBooked) {
                    timeSlot.classList.add('booked');
                    timeSlot.innerHTML = `${h}:00<br><small>จองแล้ว</small>`;
                } else {
                    timeSlot.addEventListener('click', function() {
                        // ลบการเลือกเดิม
                        document.querySelectorAll('.time-slot.selected').forEach(slot => {
                            slot.classList.remove('selected');
                        });
                        
                        // เลือกเวลาปัจจุบัน
                        this.classList.add('selected');
                        booking.time = this.dataset.time;
                    });
                }
                
                timeSlotsContainer.appendChild(timeSlot);
            }
        }

        // ฟังก์ชันบันทึกการตั้งค่า Firebase - แก้ไขให้ถูกต้อง
        function saveFirebaseConfig() {
            const configText = document.getElementById('firebaseConfig').value;
            try {
                const config = JSON.parse(configText);
                
                // ตรวจสอบว่ามีฟิลด์ที่จำเป็นครบหรือไม่
                const requiredFields = ['apiKey', 'authDomain', 'projectId', 'storageBucket', 'messagingSenderId', 'appId'];
                const missingFields = requiredFields.filter(field => !config[field]);
                
                if (missingFields.length > 0) {
                    showNotification('การตั้งค่าไม่ครบถ้วน: ' + missingFields.join(', '), 'error');
                    return;
                }
                
                localStorage.setItem('firebaseConfig', configText);
                
                // อัปเดตค่า config ใหม่
                Object.assign(firebaseConfig, config);
                
                // เริ่มต้น Firebase ใหม่
                const success = initializeFirebase(firebaseConfig);
                
                if (success) {
                    showNotification('บันทึกการตั้งค่า Firebase เรียบร้อยแล้ว', 'success');
                    // โหลดข้อมูลใหม่จาก Firebase
                    loadDataFromFirebase();
                } else {
                    showNotification('ไม่สามารถเริ่มต้น Firebase ได้', 'error');
                }
            } catch (error) {
                console.error('Error parsing Firebase config:', error);
                showNotification('รูปแบบการตั้งค่า Firebase ไม่ถูกต้อง: ' + error.message, 'error');
            }
        }

        // ฟังก์ชันทดสอบการเชื่อมต่อ Firebase - แก้ไขให้ปลอดภัย
        function testFirebaseConnection() {
            const testResult = document.getElementById('firebaseTestResult');
            testResult.style.display = 'block';
            testResult.className = 'test-result';
            testResult.innerHTML = 'กำลังทดสอบการเชื่อมต่อ...';

            if (!firebaseInitialized || !db) {
                testResult.classList.add('error');
                testResult.innerHTML = '❌ Firebase ยังไม่ได้เริ่มต้น กรุณาตั้งค่าก่อน';
                return;
            }

            // ทดสอบการอ่านข้อมูล - ใช้ collection ที่มีอยู่แล้ว
            db.collection('services').limit(1).get()
                .then((snapshot) => {
                    testResult.classList.add('success');
                    testResult.innerHTML = '✅ การเชื่อมต่อ Firebase สำเร็จ';
                    showNotification('ทดสอบการเชื่อมต่อ Firebase สำเร็จ!', 'success');
                })
                .catch(error => {
                    testResult.classList.add('error');
                    testResult.innerHTML = '❌ การเชื่อมต่อ Firebase ล้มเหลว: ' + error.message;
                    showNotification('การทดสอบ Firebase ล้มเหลว', 'error');
                });
        }

        // ฟังก์ชันโหลดข้อมูลจาก Firebase - แก้ไขให้ปลอดภัย
        function loadDataFromFirebase() {
            if (!firebaseInitialized || !db) {
                console.warn("Firebase ยังไม่พร้อม โหลดข้อมูลจาก localStorage แทน");
                loadDataFromLocalStorage();
                return;
            }

            // โหลดบริการ
            db.collection('services').get()
                .then(snapshot => {
                    services = [];
                    snapshot.forEach(doc => {
                        services.push({ id: doc.id, ...doc.data() });
                    });
                    renderServices();
                    renderServicesForBooking(); // แสดงบริการสำหรับการจองทันที
                })
                .catch(error => {
                    console.error("❌ เกิดข้อผิดพลาดในการโหลดบริการ:", error);
                });

            // โหลดวันหยุด
            db.collection('holidays').get()
                .then(snapshot => {
                    holidays = [];
                    snapshot.forEach(doc => {
                        holidays.push(doc.data().date);
                    });
                    renderHolidays();
                })
                .catch(error => {
                    console.error("❌ เกิดข้อผิดพลาดในการโหลดวันหยุด:", error);
                });

            // โหลดโปรโมชัน
            db.collection('promotions').get()
                .then(snapshot => {
                    promotions = [];
                    snapshot.forEach(doc => {
                        promotions.push({ id: doc.id, ...doc.data() });
                    });
                    renderPromotions();
                })
                .catch(error => {
                    console.error("❌ เกิดข้อผิดพลาดในการโหลดโปรโมชัน:", error);
                });

            // โหลดรีวิว
            db.collection('reviews').get()
                .then(snapshot => {
                    reviews = [];
                    snapshot.forEach(doc => {
                        reviews.push({ id: doc.id, ...doc.data() });
                    });
                    renderReviews();
                })
                .catch(error => {
                    console.error("❌ เกิดข้อผิดพลาดในการโหลดรีวิว:", error);
                });

            // โหลดการจอง
            db.collection('bookings').get()
                .then(snapshot => {
                    bookings = [];
                    snapshot.forEach(doc => {
                        bookings.push({ id: doc.id, ...doc.data() });
                    });
                    if (isLoggedIn) renderBookings();
                })
                .catch(error => {
                    console.error("❌ เกิดข้อผิดพลาดในการโหลดการจอง:", error);
                });
        }

        // ฟังก์ชันโหลดข้อมูลจาก localStorage (fallback)
        function loadDataFromLocalStorage() {
            holidays = JSON.parse(localStorage.getItem('holidays')) || [];
            services = JSON.parse(localStorage.getItem('services')) || [
                { name: "สระ - ไดร์ ผมตรง", price: "เริ่มต้นที่ 60-150 บาท" },
                { name: "สระ - ไดร์ หนีบ", price: "เริ่มต้นที่ 80-150 บาท" },
                { name: "สระผม - เด็กนักเรียน", price: "เริ่มต้นที่ 20-80 บาท" },
                { name: "สปานาโน", price: "เริ่มต้นที่ 399 บาท" }
            ];
            promotions = JSON.parse(localStorage.getItem('promotions')) || [];
            reviews = JSON.parse(localStorage.getItem('reviews')) || [];
            bookings = JSON.parse(localStorage.getItem('bookings')) || [];
        }

        // ฟังก์ชันบันทึกข้อมูลไปยัง Firebase
        function saveToFirebase(collection, data, id = null) {
            if (!firebaseInitialized) {
                // ถ้า Firebase ไม่พร้อม ให้บันทึกลง localStorage แทน
                return saveToLocalStorage(collection, data);
            }

            if (id) {
                return db.collection(collection).doc(id).set(data);
            } else {
                return db.collection(collection).add(data);
            }
        }

        // ฟังก์ชันบันทึกลง localStorage (fallback)
        function saveToLocalStorage(collection, data) {
            let items = JSON.parse(localStorage.getItem(collection)) || [];
            items.push(data);
            localStorage.setItem(collection, JSON.stringify(items));
            return Promise.resolve();
        }

        // ฟังก์ชันลบข้อมูลจาก Firebase
        function deleteFromFirebase(collection, id) {
            if (!firebaseInitialized) {
                // ถ้า Firebase ไม่พร้อม ให้ลบจาก localStorage แทน
                return deleteFromLocalStorage(collection, id);
            }

            return db.collection(collection).doc(id).delete();
        }

        // ฟังก์ชันลบจาก localStorage (fallback)
        function deleteFromLocalStorage(collection, index) {
            let items = JSON.parse(localStorage.getItem(collection)) || [];
            items.splice(index, 1);
            localStorage.setItem(collection, JSON.stringify(items));
            return Promise.resolve();
        }

        // ฟังก์ชันสร้าง floating icons
        function createFloatingIcons() {
            const icons = ['💇', '💅', '💖', '✨', '🌟', '🎀', '💫', '🌸'];
            const container = document.getElementById('floatingIcons');
            
            for (let i = 0; i < 15; i++) {
                const icon = document.createElement('div');
                icon.className = 'floating-icon';
                icon.textContent = icons[Math.floor(Math.random() * icons.length)];
                icon.style.left = Math.random() * 100 + 'vw';
                icon.style.top = Math.random() * 100 + 'vh';
                icon.style.animationDelay = Math.random() * 20 + 's';
                icon.style.fontSize = (Math.random() * 20 + 16) + 'px';
                icon.style.color = `hsl(${Math.random() * 360}, 70%, 60%)`;
                container.appendChild(icon);
            }
        }

        // ฟังก์ชันสร้าง confetti
        function createConfetti() {
            const colors = ['#d291bc', '#4a154b', '#ffdfd3', '#06C755', '#ffc107'];
            const container = document.getElementById('confettiContainer');
            
            for (let i = 0; i < 150; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.width = Math.random() * 10 + 5 + 'px';
                confetti.style.height = Math.random() * 10 + 5 + 'px';
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                container.appendChild(confetti);
                
                const animation = confetti.animate([
                    { transform: `translateY(0) rotate(0deg)`, opacity: 1 },
                    { transform: `translateY(${window.innerHeight}px) rotate(${Math.random() * 360}deg)`, opacity: 0 }
                ], {
                    duration: Math.random() * 3000 + 2000,
                    easing: 'cubic-bezier(0.215, 0.610, 0.355, 1)'
                });
                
                animation.onfinish = () => confetti.remove();
            }
        }

        // ฟังก์ชันล็อกอินด่วน
        function quickLogin() {
            const password = prompt("กรุณากรอกรหัสผ่านสำหรับเจ้าของร้าน");
            if (password === "muksalon157") {
                isLoggedIn = true;
                document.body.classList.add('logged-in');
                localStorage.setItem('isLoggedIn', 'true');
                showNotification('ล็อคอินสำเร็จในฐานะเจ้าของร้าน', 'success');
                showPage('manage');
            } else {
                showNotification('รหัสผ่านไม่ถูกต้อง', 'error');
            }
        }

        // ฟังก์ชันล็อคอินสำหรับเจ้าของร้าน
        function loginWithLine() {
            const password = prompt("กรุณากรอกรหัสผ่านสำหรับเจ้าของร้าน");
            
            if (password === "muksalon157") {
                isLoggedIn = true;
                document.body.classList.add('logged-in');
                localStorage.setItem('isLoggedIn', 'true');
                showNotification('ล็อคอินสำเร็จในฐานะเจ้าของร้าน', 'success');
                showPage('manage');
            } else {
                showNotification('รหัสผ่านไม่ถูกต้อง', 'error');
            }
        }

        // ฟังก์ชันล็อกเอาท์
        function logout() {
            isLoggedIn = false;
            document.body.classList.remove('logged-in');
            localStorage.setItem('isLoggedIn', 'false');
            showNotification('ล็อกเอาท์เรียบร้อย', 'success');
            showPage('booking');
        }

        // ฟังก์ชันแสดงหน้า
        function showPage(page) {
            document.querySelectorAll(".page").forEach(p => p.classList.remove("activePage"));
            document.getElementById(page).classList.add("activePage");
            document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
            document.querySelectorAll(".mobile-nav button").forEach(b => b.classList.remove("active"));

            // ตั้งค่าปุ่มที่ active
            const navButtons = document.querySelectorAll("nav button, .mobile-nav button");
            for (let btn of navButtons) {
                if (btn.textContent === "หน้าหลัก" && page === "home") btn.classList.add("active");
                if (btn.textContent === "จองคิว" && page === "booking") btn.classList.add("active");
                if (btn.textContent === "โปรโมชัน" && page === "promo") btn.classList.add("active");
                if (btn.textContent === "รีวิว" && page === "reviews") btn.classList.add("active");
            }

            if (page === "booking") {
                resetBookingForm();
                renderServicesForBooking();
            }
            if (page === "home") {
                renderHolidays();
                renderServices();
            }
            if (page === "promo") renderPromotions();
            if (page === "reviews") renderReviews();
            if (page === "manage") renderBookings();
            
            // ปิดเมนูมือถือเมื่อเปลี่ยนหน้า
            if (window.innerWidth <= 767) {
                toggleMobileMenu();
            }
        }

        // ฟังก์ชันรีเซ็ตฟอร์มจอง
        function resetBookingForm() {
            booking = {};
            bookingLocked = false;
            document.getElementById("name").value = "";
            document.getElementById("phone").value = "";
            document.getElementById("date").value = "";
            document.getElementById("timeSlots").innerHTML = "";
            
            // ล้างการเลือกบริการ
            document.querySelectorAll('input[name="service"]:checked').forEach(checkbox => {
                checkbox.checked = false;
            });
        }

        // ฟังก์ชันแสดงบริการสำหรับการจอง
        function renderServicesForBooking() {
            const serviceSelection = document.getElementById("serviceSelection");
            serviceSelection.innerHTML = "";
            
            if (services.length === 0) {
                serviceSelection.innerHTML = "<p>กำลังโหลดบริการ...</p>";
                return;
            }
            
            services.forEach((service, index) => {
                const serviceDiv = document.createElement("div");
                serviceDiv.className = "service-option";
                serviceDiv.innerHTML = `
                    <input type="checkbox" id="service-${index}" name="service" value="${service.name} - ${service.price}">
                    <label for="service-${index}">${service.name} - ${service.price}</label>
                `;
                serviceSelection.appendChild(serviceDiv);
            });
        }

        // ฟังก์ชันส่งการจอง
        async function submitBooking() {
            // เก็บข้อมูลการจอง
            booking.name = document.getElementById("name").value.trim();
            booking.phone = document.getElementById("phone").value.trim();
            booking.date = document.getElementById("date").value;
            
            // ตรวจสอบข้อมูล
            if (!booking.name || !booking.phone) {
                showNotification('กรุณากรอกชื่อและเบอร์โทรศัพท์', 'error');
                return;
            }
            
            if (!booking.date) {
                showNotification('กรุณาเลือกวันที่', 'error');
                return;
            }
            
            if (!booking.time) {
                showNotification('กรุณาเลือกเวลา', 'error');
                return;
            }
            
            // เก็บบริการที่เลือก
            booking.services = [];
            document.querySelectorAll('input[name="service"]:checked').forEach(checkbox => {
                booking.services.push(checkbox.value);
            });
            
            if (booking.services.length === 0) {
                showNotification('กรุณาเลือกบริการอย่างน้อยหนึ่งรายการ', 'error');
                return;
            }
            
            // ตรวจสอบว่าช่วงเวลานี้ถูกจองแล้วหรือไม่
            const hasConflict = await checkBookingConflict(booking.date, booking.time);
            if (hasConflict) {
                showNotification('⏰ มีลูกค้าอีกท่านได้จองเวลาในช่วงนี้แล้ว กรุณาเลือกเวลาอื่น', 'warning');
                return;
            }
            
            // บันทึกการจอง
            const newBooking = {
                name: booking.name,
                phone: booking.phone,
                date: booking.date,
                time: booking.time,
                services: booking.services,
                timestamp: new Date().toISOString(),
                status: "confirmed"
            };
            
            try {
                await saveToFirebase('bookings', newBooking);
                bookings.push(newBooking);
                
                // สร้าง confetti
                createConfetti();
                
                showNotification('✅ การจองสำเร็จ!', 'success');
                
                // ส่งอีเมลแจ้งเตือน
                sendEmailNotification("booking")
                    .then(success => {
                        if (success) {
                            console.log("✅ ส่ง Email การจองสำเร็จ");
                        } else {
                            console.warn("❌ ส่ง Email การจองไม่สำเร็จ");
                        }
                    });
                
                // รีเซ็ตฟอร์ม
                resetBookingForm();
                
                // แสดงฟอร์มรีวิวหลังจากจองสำเร็จ
                setTimeout(() => {
                    showReviewModal();
                }, 1500);
            } catch (error) {
                console.error("❌ เกิดข้อผิดพลาดในการบันทึกการจอง:", error);
                showNotification('เกิดข้อผิดพลาดในการบันทึกการจอง', 'error');
            }
        }

        // ฟังก์ชันตรวจสอบเวลาจองซ้ำ
        async function checkBookingConflict(date, time) {
            try {
                // ตรวจสอบใน Firebase
                if (firebaseInitialized) {
                    const snapshot = await db.collection('bookings')
                        .where('date', '==', date)
                        .where('time', '==', time)
                        .get();
                    
                    return !snapshot.empty;
                } else {
                    // ตรวจสอบใน localStorage
                    return bookings.some(b => b.date === date && b.time === time);
                }
            } catch (error) {
                console.error("❌ เกิดข้อผิดพลาดในการตรวจสอบการจองซ้ำ:", error);
                return false;
            }
        }

        // ฟังก์ชันบันทึกการตั้งค่า Email
        function saveEmailConfig() {
            // อัปเดตการตั้งค่าจากฟอร์ม
            emailConfig.publicKey = document.getElementById('emailJSPublicKey').value;
            emailConfig.serviceID = document.getElementById('emailJSServiceID').value;
            emailConfig.templateID = document.getElementById('emailJSTemplateID').value;
            emailConfig.adminEmail = document.getElementById('adminEmail').value;

            // บันทึกลง localStorage
            localStorage.setItem('emailConfig', JSON.stringify(emailConfig));
            
            // เริ่มต้น EmailJS ใหม่
            if (emailConfig.publicKey && emailConfig.publicKey !== 'your_public_key_here') {
                emailjs.init(emailConfig.publicKey);
            }
            
            showNotification('บันทึกการตั้งค่า Email เรียบร้อยแล้ว', 'success');
        }

        // ฟังก์ชันทดสอบการเชื่อมต่อ Email
        function testEmailConnection() {
            if (!emailConfig.publicKey || emailConfig.publicKey === 'your_public_key_here' ||
                !emailConfig.serviceID || emailConfig.serviceID === 'your_service_id_here' ||
                !emailConfig.templateID || emailConfig.templateID === 'your_template_id_here' ||
                !emailConfig.adminEmail || emailConfig.adminEmail === 'your_email@example.com') {
                showNotification('กรุณาตั้งค่า EmailJS ให้ครบถ้วนก่อนทดสอบ', 'error');
                return;
            }

            const testResult = document.getElementById('testResult');
            testResult.style.display = 'block';
            testResult.className = 'test-result';
            testResult.innerHTML = 'กำลังทดสอบการเชื่อมต่อ...';

            sendTestEmail()
                .then((success) => {
                    if (success) {
                        testResult.classList.add('success');
                        testResult.innerHTML = '✅ การทดสอบสำเร็จ! ควรมีอีเมลแจ้งเตือนไปยังกล่องจดหมายของคุณแล้ว';
                        showNotification('ทดสอบการส่งอีเมลสำเร็จ!', 'success');
                    } else {
                        testResult.classList.add('error');
                        testResult.innerHTML = '❌ การทดสอบล้มเหลว: ไม่สามารถส่งอีเมลได้';
                        showNotification('การทดสอบส่งอีเมลล้มเหลว', 'error');
                    }
                })
                .catch(error => {
                    testResult.classList.add('error');
                    testResult.innerHTML = '❌ การทดสอบล้มเหลว: ' + error;
                    showNotification('เกิดข้อผิดพลาดในการทดสอบ', 'error');
                });
        }

        // ฟังก์ชันส่งอีเมลทดสอบ
        async function sendTestEmail() {
            const testHtml = `
                <div style="font-family: Arial, sans-serif; font-size: 14px; line-height: 1.6;">
                    <h2 style="color: #4a154b;">🔔 ทดสอบการแจ้งเตือนจากร้านเสริมสวยมุกซาลอน</h2>
                    <p>นี่คืออีเมลทดสอบเพื่อตรวจสอบว่าการตั้งค่า EmailJS ทำงานปกติ</p>
                    <div style="background: #f9f0ff; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <p><strong>📅 วันที่ทดสอบ:</strong> ${new Date().toLocaleString('th-TH')}</p>
                        <p><strong>✅ สถานะ:</strong> ระบบแจ้งเตือนทำงานปกติแล้ว</p>
                    </div>
                    <p>หากคุณได้รับอีเมลนี้ แสดงว่าการตั้งค่าเสร็จสมบูรณ์แล้ว</p>
                </div>
            `;

            return await sendEmailNotification(
                "🔔 ทดสอบการแจ้งเตือนจากร้านเสริมสวยมุกซาลอน",
                testHtml
            );
        }

        // ฟังก์ชันจัดรูปแบบวันที่ไทย
        function formatDateThai(dateString) {
            const date = new Date(dateString);
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('th-TH', options);
        }

        // ฟังก์ชันส่งการแจ้งเตือนผ่าน Email
        async function sendEmailNotification(type = "booking") {
            // ตรวจสอบการตั้งค่า
            if (!emailConfig.publicKey || emailConfig.publicKey === 'your_public_key_here' ||
                !emailConfig.serviceID || emailConfig.serviceID === 'your_service_id_here' ||
                !emailConfig.templateID || emailConfig.templateID === 'your_template_id_here' ||
                !emailConfig.adminEmail || emailConfig.adminEmail === 'your_email@example.com') {
                console.warn("❌ การตั้งค่า Email ไม่ครบถ้วน");
                return false;
            }

            try {
                // เริ่มต้น EmailJS
                emailjs.init(emailConfig.publicKey);

                // สร้างพารามิเตอร์
                const templateParams = {
                    to_email: emailConfig.adminEmail,
                    name: booking.name || "ลูกค้า",
                    phone: booking.phone || "ไม่ระบุ",
                    date: booking.date ? formatDateThai(booking.date) : new Date().toLocaleDateString('th-TH'),
                    time: booking.time || "ไม่ระบุ",
                    services: booking.services ? booking.services.map(s => `<li>${s}</li>`).join("") : "<li>บริการทดสอบ</li>",
                    created_at: new Date().toLocaleString('th-TH')
                };

                console.log("📧 ส่งอีเมลประเภท:", type);

                const response = await emailjs.send(
                    emailConfig.serviceID, 
                    emailConfig.templateID,
                    templateParams
                );

                if (response.status === 200) {
                    console.log(`✅ ส่งอีเมล ${type} สำเร็จ!`);
                    return true;
                } else {
                    throw new Error(`EmailJS error: ${response.status} - ${response.text}`);
                }
            } catch (error) {
                console.error("❌ เกิดข้อผิดพลาดในการส่งอีเมล:", error);
                return false;
            }
        }

        // ฟังก์ชันแสดงการจอง
        function renderBookings() {
            const container = document.getElementById("bookingList");
            container.innerHTML = "";

            if (bookings.length === 0) {
                container.innerHTML = "<p>ยังไม่มีรายการจอง</p>";
                return;
            }

            const sortedBookings = [...bookings].reverse();
            sortedBookings.forEach((booking, index) => {
                const bookingDiv = document.createElement("div");
                bookingDiv.className = "booking-item";

                let servicesList = "";
                booking.services.forEach(service => {
                    servicesList += `<li>${service}</li>`;
                });

                bookingDiv.innerHTML = `
                    <div class="booking-content">
                        <p><strong>👤 ชื่อ:</strong> ${booking.name}</p>
                        <p><strong>📞 โทร:</strong> ${booking.phone}</p>
                        <p><strong>📅 วันที่:</strong> ${booking.date}</p>
                        <p><strong>⏰ เวลา:</strong> ${booking.time}</p>
                        <div class="services-section">
                            <p><strong>💇 บริการ:</strong></p>
                            <ul class="services-list">${servicesList}</ul>
                        </div>
                        <p><strong>🕒 จองเมื่อ:</strong> ${new Date(booking.timestamp).toLocaleString('th-TH')}</p>
                    </div>
                `;

                if (isLoggedIn) {
                    const actionsDiv = document.createElement("div");
                    actionsDiv.className = "booking-actions";
                    
                    const deleteBtn = document.createElement("button");
                    deleteBtn.textContent = "ลบการจอง";
                    deleteBtn.className = "delete-btn";
                    deleteBtn.onclick = function () {
                        deleteBooking(booking.id || index);
                    };
                    
                    actionsDiv.appendChild(deleteBtn);
                    bookingDiv.appendChild(actionsDiv);
                }

                container.appendChild(bookingDiv);
            });
        }

        // ฟังก์ชันลบการจอง
        async function deleteBooking(id) {
            if (!isLoggedIn) {
                showNotification('กรุณาล็อกอินก่อนลบข้อมูล', 'error');
                return;
            }

            if (confirm("คุณแน่ใจว่าต้องการลบการจองนี้?")) {
                try {
                    // ลบจาก Firebase หรือ localStorage
                    await deleteFromFirebase('bookings', id);
                    
                    // อัปเดตรายการจองในหน่วยความจำ
                    const index = bookings.findIndex(b => b.id === id);
                    if (index !== -1) {
                        bookings.splice(index, 1);
                    } else {
                        // ถ้าไม่มี id (ใช้ localStorage) ให้ลบตาม index
                        bookings.splice(id, 1);
                    }
                    
                    renderBookings();
                    showNotification('ลบการจองเรียบร้อยแล้ว', 'success');
                } catch (error) {
                    console.error("❌ เกิดข้อผิดพลาดในการลบการจอง:", error);
                    showNotification('เกิดข้อผิดพลาดในการลบการจอง', 'error');
                }
            }
        }

        // ฟังก์ชันเพิ่มบริการ
        async function addService() {
            if (!isLoggedIn) {
                showNotification('กรุณาล็อกอินก่อนเพิ่มบริการ', 'error');
                return;
            }

            const name = document.getElementById("newServiceName").value;
            const price = document.getElementById("newServicePrice").value;
            
            if (!name || !price) {
                showNotification('กรุณากรอกข้อมูลให้ครบ', 'error');
                return;
            }

            const newService = { name, price };
            
            try {
                // บันทึกลง Firebase หรือ localStorage
                await saveToFirebase('services', newService);
                services.push(newService);
                renderServices();
                renderServicesForBooking(); // อัปเดตบริการสำหรับการจองด้วย
                document.getElementById("newServiceName").value = "";
                document.getElementById("newServicePrice").value = "";
                showNotification('เพิ่มบริการเรียบร้อยแล้ว', 'success');
            } catch (error) {
                console.error("❌ เกิดข้อผิดพลาดในการเพิ่มบริการ:", error);
                showNotification('เกิดข้อผิดพลาดในการเพิ่มบริการ', 'error');
            }
        }

        // ฟังก์ชันแสดงบริการ
        function renderServices() {
            const container = document.getElementById("servicesList");
            container.innerHTML = "";

            if (services.length === 0) {
                container.innerHTML = "<p>ยังไม่มีบริการ</p>";
                return;
            }

            services.forEach((service, index) => {
                const serviceItem = document.createElement("li");
                serviceItem.className = "service-item";
                serviceItem.innerHTML = `
                    <div>
                        <strong>${service.name}</strong> - ${service.price}
                    </div>
                    ${isLoggedIn ? `<button class="delete-btn" onclick="deleteService('${service.id || index}')">ลบ</button>` : ''}
                `;
                container.appendChild(serviceItem);
            });
        }

        // ฟังก์ชันลบบริการ
        async function deleteService(id) {
            if (!isLoggedIn) {
                showNotification('กรุณาล็อกอินก่อนลบข้อมูล', 'error');
                return;
            }

            if (confirm("คุณแน่ใจว่าต้องการลบบริการนี้?")) {
                try {
                    // ลบจาก Firebase หรือ localStorage
                    await deleteFromFirebase('services', id);
                    
                    // อัปเดตรายการบริการในหน่วยความจำ
                    const index = services.findIndex(s => s.id === id);
                    if (index !== -1) {
                        services.splice(index, 1);
                    } else {
                        // ถ้าไม่มี id (ใช้ localStorage) ให้ลบตาม index
                        services.splice(id, 1);
                    }
                    
                    renderServices();
                    renderServicesForBooking(); // อัปเดตบริการสำหรับการจองด้วย
                    showNotification('ลบบริการเรียบร้อยแล้ว', 'success');
                } catch (error) {
                    console.error("❌ เกิดข้อผิดพลาดในการลบบริการ:", error);
                    showNotification('เกิดข้อผิดพลาดในการลบบริการ', 'error');
                }
            }
        }

        // ฟังก์ชันเพิ่มวันหยุด
        async function addHoliday() {
            if (!isLoggedIn) {
                showNotification('กรุณาล็อกอินก่อนเพิ่มวันหยุด', 'error');
                return;
            }

            const date = document.getElementById("newHoliday").value;
            
            if (!date) {
                showNotification('กรุณาเลือกวันที่', 'error');
                return;
            }

            if (holidays.includes(date)) {
                showNotification('วันหยุดนี้มีอยู่แล้ว', 'error');
                return;
            }
            
            try {
                // บันทึกลง Firebase หรือ localStorage
                await saveToFirebase('holidays', { date });
                holidays.push(date);
                renderHolidays();
                document.getElementById("newHoliday").value = "";
                showNotification('เพิ่มวันหยุดเรียบร้อยแล้ว', 'success');
            } catch (error) {
                console.error("❌ เกิดข้อผิดพลาดในการเพิ่มวันหยุด:", error);
                showNotification('เกิดข้อผิดพลาดในการเพิ่มวันหยุด', 'error');
            }
        }

        // ฟังก์ชันแสดงวันหยุด
        function renderHolidays() {
            const container = document.getElementById("holidayList");
            container.innerHTML = "";

            if (holidays.length === 0) {
                container.innerHTML = "<p>ยังไม่มีวันหยุด</p>";
                return;
            }

            holidays.forEach((date, index) => {
                const holidayItem = document.createElement("li");
                holidayItem.className = "holiday-item";
                holidayItem.innerHTML = `
                    <div>${new Date(date).toLocaleDateString('th-TH')}</div>
                    ${isLoggedIn ? `<button class="delete-btn" onclick="deleteHoliday('${date}')">ลบ</button>` : ''}
                `;
                container.appendChild(holidayItem);
            });
        }

        // ฟังก์ชันลบวันหยุด
        async function deleteHoliday(date) {
            if (!isLoggedIn) {
                showNotification('กรุณาล็อกอินก่อนลบข้อมูล', 'error');
                return;
            }

            if (confirm("คุณแน่ใจว่าต้องการลบวันหยุดนี้?")) {
                try {
                    // ลบจาก Firebase (ต้องค้นหา document ที่มี field date เท่ากับวันที่ต้องการลบ)
                    if (firebaseInitialized) {
                        const snapshot = await db.collection('holidays')
                            .where('date', '==', date)
                            .get();
                        
                        snapshot.forEach(doc => {
                            doc.ref.delete();
                        });
                    } else {
                        // ลบจาก localStorage
                        await deleteFromLocalStorage('holidays', holidays.indexOf(date));
                    }
                    
                    // อัปเดตรายการวันหยุดในหน่วยความจำ
                    const index = holidays.indexOf(date);
                    if (index !== -1) {
                        holidays.splice(index, 1);
                    }
                    
                    renderHolidays();
                    showNotification('ลบวันหยุดเรียบร้อยแล้ว', 'success');
                } catch (error) {
                    console.error("❌ เกิดข้อผิดพลาดในการลบวันหยุด:", error);
                    showNotification('เกิดข้อผิดพลาดในการลบวันหยุด', 'error');
                }
            }
        }

        // ฟังก์ชันเพิ่มโปรโมชัน
        async function addPromo() {
            if (!isLoggedIn) {
                showNotification('กรุณาล็อกอินก่อนเพิ่มโปรโมชัน', 'error');
                return;
            }

            const title = document.getElementById("promoTitle").value;
            const description = document.getElementById("promoDescription").value;
            const imageFile = document.getElementById("promoImageFile").files[0];
            
            if (!title || !description) {
                showNotification('กรุณากรอกข้อมูลให้ครบ', 'error');
                return;
            }

            let imageUrl = "";
            
            // อัปโหลดรูปภาพถ้ามี
            if (imageFile) {
                // ในกรณีนี้เราจะเก็บเป็น base64 เนื่องจากไม่มี Firebase Storage
                // ในเวอร์ชันจริงควรใช้ Firebase Storage สำหรับอัปโหลดรูปภาพ
                imageUrl = await readFileAsDataURL(imageFile);
            }

            const newPromo = { 
                title, 
                description, 
                imageUrl,
                timestamp: new Date().toISOString()
            };
            
            try {
                // บันทึกลง Firebase หรือ localStorage
                await saveToFirebase('promotions', newPromo);
                promotions.push(newPromo);
                renderPromotions();
                document.getElementById("promoTitle").value = "";
                document.getElementById("promoDescription").value = "";
                document.getElementById("promoImageFile").value = "";
                showNotification('เพิ่มโปรโมชันเรียบร้อยแล้ว', 'success');
            } catch (error) {
                console.error("❌ เกิดข้อผิดพลาดในการเพิ่มโปรโมชัน:", error);
                showNotification('เกิดข้อผิดพลาดในการเพิ่มโปรโมชัน', 'error');
            }
        }

        // ฟังก์ชันอ่านไฟล์เป็น Data URL
        function readFileAsDataURL(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // ฟังก์ชันแสดงโปรโมชัน
        function renderPromotions() {
            const container = document.getElementById("promoContent");
            container.innerHTML = "";

            if (promotions.length === 0) {
                container.innerHTML = "<p>ยังไม่มีโปรโมชัน</p>";
                return;
            }

            const sortedPromos = [...promotions].reverse();
            sortedPromos.forEach((promo, index) => {
                const promoItem = document.createElement("div");
                promoItem.className = "promo-item";
                
                let imageHtml = "";
                if (promo.imageUrl) {
                    imageHtml = `<img src="${promo.imageUrl}" alt="${promo.title}" class="promo-image">`;
                }
                
                promoItem.innerHTML = `
                    ${imageHtml}
                    <div class="promo-title">${promo.title}</div>
                    <div class="promo-description">${promo.description}</div>
                    ${isLoggedIn ? `<button class="delete-btn" onclick="deletePromo('${promo.id || index}')">ลบโปรโมชัน</button>` : ''}
                `;
                container.appendChild(promoItem);
            });
        }

        // ฟังก์ชันลบโปรโมชัน
        async function deletePromo(id) {
            if (!isLoggedIn) {
                showNotification('กรุณาล็อกอินก่อนลบข้อมูล', 'error');
                return;
            }

            if (confirm("คุณแน่ใจว่าต้องการลบโปรโมชันนี้?")) {
                try {
                    // ลบจาก Firebase หรือ localStorage
                    await deleteFromFirebase('promotions', id);
                    
                    // อัปเดตรายการโปรโมชันในหน่วยความจำ
                    const index = promotions.findIndex(p => p.id === id);
                    if (index !== -1) {
                        promotions.splice(index, 1);
                    } else {
                        // ถ้าไม่มี id (ใช้ localStorage) ให้ลบตาม index
                        promotions.splice(id, 1);
                    }
                    
                    renderPromotions();
                    showNotification('ลบโปรโมชันเรียบร้อยแล้ว', 'success');
                } catch (error) {
                    console.error("❌ เกิดข้อผิดพลาดในการลบโปรโมชัน:", error);
                    showNotification('เกิดข้อผิดพลาดในการลบโปรโมชัน', 'error');
                }
            }
        }

        // ฟังก์ชันแสดงรีวิว
        function renderReviews() {
            const container = document.getElementById("reviewsList");
            container.innerHTML = "";

            if (reviews.length === 0) {
                container.innerHTML = "<p>ยังไม่มีรีวิว</p>";
                return;
            }

            const sortedReviews = [...reviews].reverse();
            sortedReviews.forEach(review => {
                const reviewItem = document.createElement("div");
                reviewItem.className = "review-item"; // ใช้ class ใหม่สำหรับ styling
                
                let stars = "";
                for (let i = 1; i <= 5; i++) {
                    stars += i <= review.rating ? "★" : "☆";
                }
                
                // ✅ แก้ไข: เพิ่มปุ่มลบสำหรับเจ้าของร้าน
                reviewItem.innerHTML = `
                    <div class="review-header">
                        <div class="reviewer-name">${review.name || "ไม่ระบุชื่อ"}</div>
                        <div class="review-date">${new Date(review.timestamp).toLocaleDateString('th-TH')}</div>
                    </div>
                    <div class="stars">${stars}</div>
                    <p>${review.comment || "ไม่มีข้อความเพิ่มเติม"}</p>
                    ${isLoggedIn ? `
                        <div class="review-actions">
                            <button class="delete-btn" onclick="deleteReview('${review.id}')">
                                <i class="fas fa-trash"></i> ลบรีวิว
                            </button>
                        </div>
                    ` : ''}
                `;
                container.appendChild(reviewItem);
            });
        }

        // ฟังก์ชันแสดงการจัดการรีวิว (สำหรับเจ้าของร้าน)
        function renderReviewsManagement() {
            const container = document.getElementById("reviewsManagementList");
            if (!container) return;
            
            container.innerHTML = "";

            if (reviews.length === 0) {
                container.innerHTML = "<p>ยังไม่มีรีวิว</p>";
                return;
            }

            const sortedReviews = [...reviews].reverse();
            sortedReviews.forEach(review => {
                const reviewItem = document.createElement("div");
                reviewItem.className = "review-item";
                
                let stars = "";
                for (let i = 1; i <= 5; i++) {
                    stars += i <= review.rating ? "★" : "☆";
                }
                
                reviewItem.innerHTML = `
                    <div class="review-header">
                        <div class="reviewer-name">${review.name || "ไม่ระบุชื่อ"}</div>
                        <div class="review-date">${new Date(review.timestamp).toLocaleDateString('th-TH')}</div>
                    </div>
                    <div class="stars">${stars}</div>
                    <p>${review.comment || "ไม่มีข้อความเพิ่มเติม"}</p>
                    <div class="review-actions">
                        <button class="delete-btn" onclick="deleteReview('${review.id}')">
                            <i class="fas fa-trash"></i> ลบรีวิว
                        </button>
                    </div>
                `;
                container.appendChild(reviewItem);
            });
        }

        // ฟังก์ชันลบรีวิว
        async function deleteReview(id) {
            if (!isLoggedIn) {
                showNotification('กรุณาล็อกอินก่อนลบรีวิว', 'error');
                return;
            }

            if (confirm("คุณแน่ใจว่าต้องการลบรีวิวนี้?")) {
                try {
                    await deleteFromFirebase('reviews', id);
                    
                    // ลบรีวิวออกจากอาร์เรย์
                    const index = reviews.findIndex(r => r.id === id);
                    if (index !== -1) {
                        reviews.splice(index, 1);
                    }
                    
                    // รีเฟรชการแสดงผล
                    renderReviews();
                    if (isLoggedIn) {
                        renderReviewsManagement();
                    }
                    
                    showNotification('ลบรีวิวเรียบร้อยแล้ว', 'success');
                } catch (error) {
                    console.error("❌ เกิดข้อผิดพลาดในการลบรีวิว:", error);
                    showNotification('เกิดข้อผิดพลาดในการลบรีวิว', 'error');
                }
            }
        }

        // ฟังก์ชันแสดง modal รีวิว
        function showReviewModal() {
            document.getElementById("reviewModal").style.display = "flex";
            currentRating = 0;
            document.getElementById("reviewerName").value = "";
            document.getElementById("reviewComment").value = "";
            document.getElementById("thanksMsg").innerHTML = "";
            
            // รีเซ็ตดาว
            const stars = document.querySelectorAll("#modalStars span");
            stars.forEach(star => {
                star.classList.remove("active");
            });
        }

        // ฟังก์ชันตั้งค่าคะแนนใน modal
        function setModalRating(rating) {
            currentRating = rating;
            const stars = document.querySelectorAll("#modalStars span");
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.add("active");
                } else {
                    star.classList.remove("active");
                }
            });
        }

        // ฟังก์ชันส่งรีวิว - แก้ไขให้เรียก renderReviewsManagement() ด้วย
        async function submitReview() {
            const name = document.getElementById("reviewerName").value.trim() || "ไม่ระบุชื่อ";
            const comment = document.getElementById("reviewComment").value.trim() || "";
            
            if (currentRating === 0) {
                showNotification('กรุณาให้คะแนนดาว', 'error');
                return;
            }

            const newReview = {
                name,
                rating: currentRating,
                comment,
                timestamp: new Date().toISOString()
            };
            
            try {
                await saveToFirebase('reviews', newReview);
                reviews.push(newReview);
                
                // ✅ แก้ไข: รีเฟรชทั้งสองส่วน
                renderReviews();
                if (isLoggedIn) {
                    renderReviewsManagement();
                }
                
                document.getElementById("thanksMsg").innerHTML = "ขอบคุณสำหรับรีวิวค่ะ 💖";
                setTimeout(() => {
                    document.getElementById("reviewModal").style.display = "none";
                    showPage("reviews");
                }, 2000);
                
                showNotification('ส่งรีวิวเรียบร้อยแล้ว', 'success');
            } catch (error) {
                console.error("❌ เกิดข้อผิดพลาดในการส่งรีวิว:", error);
                showNotification('เกิดข้อผิดพลาดในการส่งรีวิว', 'error');
            }
        }

        // ฟังก์ชันแสดงหน้า - แก้ไขให้เรียก renderReviewsManagement() เมื่อแสดงหน้า manage
        function showPage(page) {
            document.querySelectorAll(".page").forEach(p => p.classList.remove("activePage"));
            document.getElementById(page).classList.add("activePage");
            document.querySelectorAll("nav button, .mobile-nav button").forEach(b => b.classList.remove("active"));

            // ตั้งค่าปุ่มที่ active
            const navButtons = document.querySelectorAll("nav button, .mobile-nav button");
            for (let btn of navButtons) {
                if (btn.textContent === "หน้าหลัก" && page === "home") btn.classList.add("active");
                if (btn.textContent === "จองคิว" && page === "booking") btn.classList.add("active");
                if (btn.textContent === "โปรโมชัน" && page === "promo") btn.classList.add("active");
                if (btn.textContent === "รีวิว" && page === "reviews") btn.classList.add("active");
            }

            if (page === "booking") {
                resetBookingForm();
                renderServicesForBooking();
            }
            if (page === "home") {
                renderHolidays();
                renderServices();
            }
            if (page === "promo") renderPromotions();
            if (page === "reviews") renderReviews(); // ✅ แสดงรีวิวปกติ
            if (page === "manage") {
                renderBookings();
                renderReviewsManagement(); // ✅ แสดงการจัดการรีวิว
            }
            
            if (window.innerWidth <= 767) {
                toggleMobileMenu();
            }
        }

        // ฟังก์ชันแสดงการแจ้งเตือน
        function showNotification(message, type) {
            // ลบการแจ้งเตือนเก่าทิ้งก่อน
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => {
                notification.remove();
            });
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <span>${message}</span>
                <button onclick="this.parentElement.remove()">×</button>
            `;
            
            document.body.appendChild(notification);
            
            // ลบการแจ้งเตือนอัตโนมัติหลังจาก 5 วินาที
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        // ฟังก์ชันสร้าง particles (สำหรับลูกเล่นพื้นหลัง)
        function createParticles() {
            // ฟังก์ชันนี้สามารถเพิ่มลูกเล่นเพิ่มเติมได้
        }
    </script>
</body>
</html>
